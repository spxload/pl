name: üìÇ Move Folder via Action

on:
  workflow_dispatch:
    inputs:
      source_path:
        description: '–ö–∞–∫—É—é –ø–∞–ø–∫—É –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å? (–ü—É—Ç—å –æ—Ç –∫–æ—Ä–Ω—è, –Ω–∞–ø—Ä–∏–º–µ—Ä: Plugins/OldTool)'
        required: true
        type: string
      target_path:
        description: '–ù–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è –ø–∞–ø–∫–∏ (–ù–∞–ø—Ä–∏–º–µ—Ä: Archive/OldTool)'
        required: true
        type: string

jobs:
  move-folder:
    runs-on: ubuntu-latest
    permissions:
      contents: write # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

    steps:
      # 1. –°–∫–∞—á–∏–≤–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true # –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É LFS –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –≤ –ø–∞–ø–∫–µ –µ—Å—Ç—å —Ç—è–∂–µ–ª—ã–µ —Ñ–∞–π–ª—ã

      # 2. –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
      - name: Move Directory
        id: move_step
        shell: bash
        run: |
          SOURCE="${{ inputs.source_path }}"
          TARGET="${{ inputs.target_path }}"

          echo "üîÑ Attempting to move: '$SOURCE' -> '$TARGET'"

          # –ü—Ä–æ–≤–µ—Ä–∫–∞: –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∏—Å—Ö–æ–¥–Ω–∞—è –ø–∞–ø–∫–∞?
          if [ ! -d "$SOURCE" ]; then
            echo "‚ùå Error: Source folder '$SOURCE' does not exist in the repository."
            exit 1
          fi

          # –°–æ–∑–¥–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –ø–∞–ø–∫—É –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
          # –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ü–µ–ª—å "A/B/C", –∞ –ø–∞–ø–∫–∏ "A/B" –Ω–µ—Ç, –æ–Ω–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è.
          PARENT_DIR=$(dirname "$TARGET")
          mkdir -p "$PARENT_DIR"

          # –ü–µ—Ä–µ–º–µ—â–∞–µ–º
          # –ò—Å–ø–æ–ª—å–∑—É–µ–º 'mv', —Ç–∞–∫ –∫–∞–∫ git mv –º–æ–∂–µ—Ç –∫–∞–ø—Ä–∏–∑–Ω–∏—á–∞—Ç—å –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö, 
          # –∞ git-auto-commit-action —Å–∞–º —Ä–∞–∑–±–µ—Ä–µ—Ç—Å—è —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏.
          mv "$SOURCE" "$TARGET"

          echo "‚úÖ Successfully moved folder."
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
          ls -R "$TARGET"

      # 3. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "üìÇ Moved folder: ${{ inputs.source_path }} to ${{ inputs.target_path }}"
          branch: ${{ github.ref }}
          skip_dirty_check: false    
          create_branch: false
