# –§–∞–π–ª: .github/workflows/1-scan-archives.yml

name: 1. üîç Scan & Create Menu
# ... (–Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º) ...

jobs:
  create-selection-issue:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Find Archives and Create Issue
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PATTERN: ${{ inputs.search_pattern }}
        run: |
          # --- FIX: –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–∫–∏ 'unzip-trigger' ---
          echo "üè∑Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–µ—Ç–∫–∏ 'unzip-trigger'..."
          # –°–æ–∑–¥–∞–µ–º –º–µ—Ç–∫—É. –ï—Å–ª–∏ –æ–Ω–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, '|| true' –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫—É —Å–∫—Ä–∏–ø—Ç–∞.
          gh label create 'unzip-trigger' --description 'Trigger for automated unzipping workflow' --color 0e8a16 || true
          # --------------------------------------------------------
          
          # –ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–ª–∞ Issue
          BODY="### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
          **–ü–∞–ø–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:**
          TargetFolder: unzipped_content
          *(–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞–ø–∫—É: –Ω–∞–∂–º–∏—Ç–µ 'Edit' –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–º–µ–Ω—è–π—Ç–µ —Ç–µ–∫—Å—Ç –≤—ã—à–µ)*

          ---
          ### üì¶ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã
          –û—Ç–º–µ—Ç—å—Ç–µ –≥–∞–ª–æ—á–∫–∞–º–∏ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –Ω–∞–∂–º–∏—Ç–µ **Close issue** –¥–ª—è –∑–∞–ø—É—Å–∫–∞.
          "
          
          shopt -s globstar nullglob
          
          FOUND=false
          for file in $PATTERN; do
            if [[ "$file" == .git* ]]; then continue; fi
            FOUND=true
            BODY+=$'\n- [ ] '"$file"
          done
          
          if [ "$FOUND" = false ]; then
            echo "‚ùå No files found."
            exit 1
          fi

          # –°–æ–∑–¥–∞–µ–º Issue –∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –º–µ—Ç–∫—É (—Ç–µ–ø–µ—Ä—å –º–µ—Ç–∫–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
          gh issue create \
            --title "Select archives to unzip [WAITING_SELECTION]" \
            --body "$BODY" \
            --label "unzip-trigger"

          echo "‚úÖ Issue created! Go select files and close the issue."