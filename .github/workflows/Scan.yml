name: 1. üîç Scan & Create Menu

on:
  workflow_dispatch:
    inputs:
      search_pattern:
        description: '–ì–¥–µ –∏—Å–∫–∞—Ç—å? (–ø–∞—Ç—Ç–µ—Ä–Ω)'
        default: '**/*.zip'
        required: true

jobs:
  create-selection-issue:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Find Archives and Create Issue
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PATTERN: ${{ inputs.search_pattern }}
        run: |
          # –í–ê–ñ–ù–û: –ú—ã –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É "TargetFolder: ..."
          # Action 2 –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –∏–º–µ–Ω–Ω–æ –µ—ë.
          BODY="### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
          **–ü–∞–ø–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:**
          TargetFolder: unzipped_content
          *(–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞–ø–∫—É: –Ω–∞–∂–º–∏—Ç–µ 'Edit' –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É —ç—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–º–µ–Ω—è–π—Ç–µ —Ç–µ–∫—Å—Ç –≤—ã—à–µ)*

          ---
          ### üì¶ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã
          –û—Ç–º–µ—Ç—å—Ç–µ –≥–∞–ª–æ—á–∫–∞–º–∏ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –Ω–∞–∂–º–∏—Ç–µ **Close issue** –¥–ª—è –∑–∞–ø—É—Å–∫–∞.
          "
          
          shopt -s globstar nullglob
          
          FOUND=false
          for file in $PATTERN; do
            if [[ "$file" == .git* ]]; then continue; fi
            FOUND=true
            BODY+=$'\n- [ ] '"$file"
          done
          
          if [ "$FOUND" = false ]; then
            echo "‚ùå No files found."
            exit 1
          fi

          gh issue create \
            --title "Select archives to unzip [WAITING_SELECTION]" \
            --body "$BODY" \
            --label "unzip-trigger"

          echo "‚úÖ Issue created!"
