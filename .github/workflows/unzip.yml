name: üì¶ Unpack Zip & Commit (Fixed)

on:
  workflow_dispatch:
    inputs:
      destination:
        description: '–ö—É–¥–∞ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å? (–ü–∞–ø–∫–∞)'
        required: false
        default: 'unzipped_content'
        type: string
      clean_destination:
        description: '–û—á–∏—Å—Ç–∏—Ç—å –ø–∞–ø–∫—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è?'
        required: true
        default: false
        type: boolean

jobs:
  unpack-and-commit:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true # –í–ê–ñ–ù–û: –°–∫–∞—á–∏–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Git LFS

      - name: Install Unzip
        run: sudo apt-get install -y unzip

      - name: Find and Unzip Safely
        id: unzip_step
        shell: bash
        run: |
          DEST_DIR="${{ inputs.destination }}"
          mkdir -p "$DEST_DIR"
          
          if [ "${{ inputs.clean_destination }}" = "true" ]; then
            echo "üßπ Cleaning destination directory..."
            rm -rf "$DEST_DIR"/*
          fi

          echo "üîé Searching for .zip files recursively..."
          
          # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ zip —Ñ–∞–π–ª—ã. –ò—Å–ø–æ–ª—å–∑—É–µ–º -print0 –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–º–µ–Ω —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
          find . -type f -name "*.zip" -not -path "./.git/*" -print0 | while IFS= read -r -d '' archive; do
            
            echo "---------------------------------------------------"
            echo "üì¶ Found archive: $archive"

            # –ü—Ä–æ–≤–µ—Ä–∫–∞: –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ —ç—Ç–æ ZIP —Ñ–∞–π–ª?
            if ! unzip -tq "$archive"; then
               echo "‚ö†Ô∏è WARNING: File '$archive' is not a valid zip archive or is corrupted."
               echo "It might be a Git LFS pointer that wasn't downloaded correctly."
               continue # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–∏—Ç—ã–π —Ñ–∞–π–ª, –Ω–æ –Ω–µ –ª–æ–º–∞–µ–º –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å
            fi

            echo "üöÄ Unzipping to: $DEST_DIR"
            # -o –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç, -d —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∞–ø–∫—É
            unzip -o "$archive" -d "$DEST_DIR"
            
          done
          
          echo "üéâ Extraction logic finished."

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "üì¶ Unpacked archives via Action"
          branch: ${{ github.ref }}
          file_pattern: '${{ inputs.destination }}/*'
          skip_dirty_check: false    
          create_branch: false
