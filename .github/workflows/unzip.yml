name: üì¶ Unpack Zip (7z) & Commit

on:
  workflow_dispatch:
    inputs:
      destination:
        description: '–ö—É–¥–∞ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å? (–ü–∞–ø–∫–∞)'
        required: false
        default: 'unzipped_content'
        type: string
      clean_destination:
        description: '–û—á–∏—Å—Ç–∏—Ç—å –ø–∞–ø–∫—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è?'
        required: true
        default: false
        type: boolean

jobs:
  unpack-and-commit:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true

      # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 7-Zip –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ unzip
      - name: Install 7-Zip
        run: sudo apt-get update && sudo apt-get install -y p7zip-full

      - name: Find and Unzip with 7z
        id: unzip_step
        shell: bash
        run: |
          DEST_DIR="${{ inputs.destination }}"
          mkdir -p "$DEST_DIR"
          
          if [ "${{ inputs.clean_destination }}" = "true" ]; then
            echo "üßπ Cleaning destination directory..."
            rm -rf "$DEST_DIR"/*
          fi

          echo "üîé Searching for .zip files recursively..."
          
          # –ò—â–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã zip
          find . -type f -name "*.zip" -not -path "./.git/*" -print0 | while IFS= read -r -d '' archive; do
            
            echo "---------------------------------------------------"
            echo "üì¶ Processing: $archive"

            # –ö–æ–º–∞–Ω–¥–∞ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ —á–µ—Ä–µ–∑ 7z
            # x = —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—É—Ç–µ–π
            # -o = –ø–∞–ø–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (—Å–ª–∏—Ç–Ω–æ, –±–µ–∑ –ø—Ä–æ–±–µ–ª–∞!)
            # -y = –æ—Ç–≤–µ—á–∞—Ç—å "–¥–∞" –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—å)
            if 7z x "$archive" -o"$DEST_DIR" -y; then
                echo "‚úÖ Successfully unpacked: $archive"
            else
                echo "‚ùå Failed to unpack: $archive"
                # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å exit 1, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ—Ä–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ
            fi
            
          done
          
          echo "üéâ Extraction logic finished."

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "üì¶ Unpacked archives via Action (7z)"
          branch: ${{ github.ref }}
          file_pattern: '${{ inputs.destination }}/*'
          skip_dirty_check: false    
          create_branch: false
