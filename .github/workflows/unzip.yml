name: üì¶ Unpack Zip & Commit

on:
  workflow_dispatch:
    inputs:
      search_pattern:
        description: '–ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∏—Å–∫–∞—Ç—å? (–ù–∞–ø—Ä–∏–º–µ—Ä: **/*.zip –∏–ª–∏ data.zip)'
        required: true
        default: '**/*.zip'
        type: string
      destination:
        description: '–ö—É–¥–∞ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å? (–ü–∞–ø–∫–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)'
        required: false
        default: 'unzipped_content'
        type: string
      clean_destination:
        description: '–û—á–∏—Å—Ç–∏—Ç—å –ø–∞–ø–∫—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–æ–π?'
        required: true
        default: false
        type: boolean

jobs:
  unpack-and-commit:
    runs-on: ubuntu-latest
    # –í–∞–∂–Ω–æ: –¥–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, —á—Ç–æ–±—ã Action –º–æ–≥ —Å–¥–µ–ª–∞—Ç—å git push
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Unzip
        run: sudo apt-get install -y unzip

      - name: Find and Unzip
        id: unzip_step
        shell: bash
        run: |
          echo "üîé Searching for archives matching: ${{ inputs.search_pattern }}"
          
          DEST_DIR="${{ inputs.destination }}"
          mkdir -p "$DEST_DIR"
          
          # –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ - —É–¥–∞–ª—è–µ–º –≤—Å—ë –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
          if [ "${{ inputs.clean_destination }}" = "true" ]; then
            echo "üßπ Cleaning destination directory..."
            rm -rf "$DEST_DIR"/*
          fi

          # –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (**/*.zip)
          shopt -s globstar nullglob
          
          FILES=(${{ inputs.search_pattern }})
          
          if [ ${#FILES[@]} -eq 0 ]; then
            echo "‚ùå No archives found matching the pattern."
            exit 1
          fi

          echo "‚úÖ Found ${#FILES[@]} archive(s)."

          for archive in "${FILES[@]}"; do
            echo "üì¶ Unpacking: $archive -> $DEST_DIR"
            # -o –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã, -d —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∞–ø–∫—É
            unzip -o "$archive" -d "$DEST_DIR"
          done
          
          echo "üéâ Extraction complete."

      # –®–∞–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–º–º–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "üì¶ Unpacked archives: ${{ inputs.search_pattern }}"
          branch: ${{ github.ref }}
          # –ö–æ–º–º–∏—Ç–∏–º —Ç–æ–ª—å–∫–æ –ø–∞–ø–∫—É, –≤ –∫–æ—Ç–æ—Ä—É—é —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–ª–∏, —á—Ç–æ–±—ã –Ω–µ –∑–∞–¥–µ—Ç—å –ª–∏—à–Ω–µ–µ
          file_pattern: '${{ inputs.destination }}/*' 
          skip_dirty_check: false    
          create_branch: false
